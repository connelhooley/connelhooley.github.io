<html lang=" en ">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Connel Hooley - Calling F# Code in a C# Project</title>
    
    <link rel="stylesheet" href="/assets/css/vendor/normalize.css?1589473142522212500">
    <link rel="stylesheet" href="/assets/css/vendor/stickyfill.css?1589473142522212500">
    <link rel="stylesheet" href="/assets/css/site.css?1589473142522212500">
    
    <link rel="alternate" type="application/rss+xml" title="Connel Hooley" href="/feed.xml">  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#f8bb15">
    <meta name="theme-color" content="#f8bb15">
    
    
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Calling F# Code in a C# Project" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A brief overview of how F# code is exposed to C# projects" />
<meta property="og:description" content="A brief overview of how F# code is exposed to C# projects" />
<link rel="canonical" href="https://connelhooley.uk/blog/2017/04/30/f-sharp-to-c-sharp" />
<meta property="og:url" content="https://connelhooley.uk/blog/2017/04/30/f-sharp-to-c-sharp" />
<meta property="og:site_name" content="Connel Hooley" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-04-30T18:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@connel_dev" />
<meta name="twitter:creator" content="@connel_dev" />
<script type="application/ld+json">
{"description":"A brief overview of how F# code is exposed to C# projects","@type":"BlogPosting","url":"https://connelhooley.uk/blog/2017/04/30/f-sharp-to-c-sharp","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://connelhooley.uk/assets/images/logo.png"}},"headline":"Calling F# Code in a C# Project","dateModified":"2017-04-30T18:00:00+01:00","datePublished":"2017-04-30T18:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://connelhooley.uk/blog/2017/04/30/f-sharp-to-c-sharp"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta property="fb:app_id" content="1962072957454562" />
    
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57397582-1', 'auto');
  ga('send', 'pageview');

</script>

</head>
<body id="layout-post">
    
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.12&appId=1962072957454562&autoLogAppEvents=1';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

    <div id="site-header-bar">
    <div id="site-header-bar-inner">
        <div id="site-nav">
            <a id="site-logo" href="/">{C.H}</a>
            <button id="site-nav-mobile-toggler"><i class="fas fa-bars"></i></button>
        </div>
        <nav id="site-nav-links">
            <a class="site-nav-item site-nav-item-post site-nav-item-active" href="/blog/">Blog</a>
            
            
                
                
                
                <a class="site-nav-item site-nav-item-projects" href="/projects/">Projects</a>
                
            
                
                
                
                <a class="site-nav-item site-nav-item-experiences" href="/experience/">Experience</a>
                
            
        </nav>
    </div>
</div>
<main id="site-main">
    <article>
    <header id="post-header">
        <div id="post-header-inner">
            <h1 id="post-header-title" class="post-header-item" itemprop="name headline">Calling F# Code in a C# Project</h1>
            
            <div id="post-header-description" class="post-header-item">
                A brief overview of how F# code is exposed to C# projects
            </div>
            
            
            <div id="post-header-published" class="post-header-item">
                <time datetime="2017-04-30T18:00:00+01:00" itemprop="date">
                    <date class="date" datetime="2017-04-30 18:00:00 +0100"><i class="far fa-calendar-alt"></i>&nbsp;30/04/2017</date>
                </time>
            </div>
            
            
            <div id="post-header-reading-time" class="post-header-item">
                <i class="far fa-clock"></i>&nbsp;Read in under 35  minutes
            </div>
            
            
            
            
            <div id="post-header-meta" class="post-header-item">
                
<span class="meta-item"><i class="fas fa-code"></i>&nbsp;F#</span>

<span class="meta-item"><i class="fas fa-code"></i>&nbsp;C#</span>


            </div>
            
        </div>
    </header>
    
    
    
    
    <div id="post-toolbar" class="sticky">
        <div id="post-toolbar-inner">
            <div id="post-toolbar-buttons">
                <div id="post-toolbar-share-buttons">
                    <span id="post-toolbar-share-buttons-label"><i class="fas fa-share-alt fa-fw"></i>&nbsp;<span class="post-toolbar-button-label">Share&nbsp;</span></span>
                    <a class="post-toolbar-button" target="_BLANK" href="https://twitter.com/intent/tweet?text=Calling+F%23+Code+in+a+C%23+Project+by+%40connel_dev&url=https%3A%2F%2Fconnelhooley.uk%2Fblog%2F2017%2F04%2F30%2Ff-sharp-to-c-sharp"><i class="fab fa-twitter-square fa-fw"></i><span class="post-toolbar-button-label">&nbsp;Twitter</span></a>
                    <a class="post-toolbar-button" target="_BLANK" href="//www.reddit.com/submit?url=https%3A%2F%2Fconnelhooley.uk%2Fblog%2F2017%2F04%2F30%2Ff-sharp-to-c-sharp&title=Calling+F%23+Code+in+a+C%23+Project"><i class="fab fa-reddit-square fa-fw"></i><span class="post-toolbar-button-label">&nbsp;Reddit</span></a>
                    <a class="post-toolbar-button" target="_BLANK" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fconnelhooley.uk%2Fblog%2F2017%2F04%2F30%2Ff-sharp-to-c-sharp&title=Calling+F%23+Code+in+a+C%23+Project"><i class="fab fa-linkedin fa-fw"></i><span class="post-toolbar-button-label">&nbsp;LinkedIn</span></a>
                </div>
                <div id="post-toolbar-scroll-buttons">
                    <button id="post-toolbar-button-back-to-top" class="post-toolbar-button"><i class="fas fa-arrow-up fa-fw"></i><span class="post-toolbar-button-label">&nbsp;Back to top</span></button>
                    
                    <a class="post-toolbar-button" href="#comments"><i class="fas fa-comments fa-fw"></i><span class="post-toolbar-button-label">&nbsp;Comments&nbsp;(<span class="fb-comments-count" data-href="https://connelhooley.uk/blog/2017/04/30/f-sharp-to-c-sharp"></span>)</span></a>
                    
                </div>
            </div>
        </div>
    </div>
    <div id="post-body">
        <div id="post-body-inner">
            
            <nav id="post-toc">
                <div id="post-toc-title">Contents</div>
                <div id="post-toc-items"><ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#introduction">Introduction</a></li>
<li class="toc-entry toc-h1"><a href="#namespaces">Namespaces</a></li>
<li class="toc-entry toc-h1"><a href="#modules">Modules</a>
<ul>
<li class="toc-entry toc-h2"><a href="#values">Values</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#functions">Functions</a></li>
<li class="toc-entry toc-h1"><a href="#records">Records</a></li>
<li class="toc-entry toc-h1"><a href="#tuples">Tuples</a>
<ul>
<li class="toc-entry toc-h2"><a href="#background">Background</a></li>
<li class="toc-entry toc-h2"><a href="#f-tuple">F# Tuple</a></li>
<li class="toc-entry toc-h2"><a href="#c-tuple">C# Tuple</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#discriminated-unions">Discriminated Unions</a>
<ul>
<li class="toc-entry toc-h2"><a href="#cases-with-values">Cases With Values</a></li>
<li class="toc-entry toc-h2"><a href="#cases-with-types">Cases With Types</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#unit">Unit</a></li>
<li class="toc-entry toc-h1"><a href="#higher-order-functions">Higher Order Functions</a></li>
<li class="toc-entry toc-h1"><a href="#option">Option</a></li>
<li class="toc-entry toc-h1"><a href="#collections">Collections</a>
<ul>
<li class="toc-entry toc-h2"><a href="#seq">Seq</a></li>
<li class="toc-entry toc-h2"><a href="#list">List</a></li>
<li class="toc-entry toc-h2"><a href="#array">Array</a></li>
</ul>
</li>
</ul></div>
            </nav>
            
            <div id="post-content" itemprop="articleBody">
                <h1 id="introduction">Introduction</h1>
<p>F# compiles down into the same IL code as VB and C#. This means that you can have a solution that contains both C# and F# projects. There are lots of guidelines on how to write F# code that is compatible with C# projects. You can find the official ones <a href="http://fsharp.org/specs/component-design-guidelines/#5-guidelines-for-libraries-for-use-from-other-net-languages">here</a>.</p>

<p>But why are there guidelines? Why do we have to write F# differently depending on what language is consuming it? What happens if you just write F# code without following the guidelines and then try and use it from C#?</p>

<p>F# is a multi-paradigm language. It can be used to write functional or object orientated code. OO code in F# (such as classes or interfaces) can be accessed just fine from C#.</p>

<p>The following F# code creates a class that inherits from an interface:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">Interoperability</span><span class="p">.</span><span class="nc">FSharp</span>

<span class="k">type</span> <span class="nc">ILogin</span> <span class="p">=</span>
   <span class="k">abstract</span> <span class="k">member</span> <span class="nc">IsValid</span><span class="p">:</span> <span class="kt">bool</span>

<span class="k">type</span> <span class="nc">Login</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="kt">int</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span><span class="kt">string</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span><span class="kt">string</span><span class="p">)</span> <span class="p">=</span>
    <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nc">Id</span> <span class="p">=</span> <span class="n">id</span>
    <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nc">Username</span> <span class="p">=</span> <span class="n">username</span>
    <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nc">Password</span> <span class="p">=</span> <span class="n">password</span>
    <span class="k">interface</span> <span class="nc">ILogin</span> <span class="k">with</span> 
        <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nc">IsValid</span> <span class="p">=</span> <span class="n">this</span><span class="p">.</span><span class="nc">Username</span> <span class="p">=</span> <span class="s2">"connel"</span> <span class="p">&amp;&amp;</span> <span class="n">this</span><span class="p">.</span><span class="nc">Password</span> <span class="p">=</span> <span class="s2">"password"</span>
</code></pre></div></div>

<p>This code is easy to consume from C#:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Interoperability.FSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Interoperability.CSharp</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Login</span> <span class="n">login</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Login</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="s">"connel"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">);</span>
            <span class="nf">PrintWelcomeMessage</span><span class="p">(</span><span class="n">login</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">PrintWelcomeMessage</span><span class="p">(</span><span class="n">ILogin</span> <span class="n">login</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">login</span><span class="p">.</span><span class="n">IsValid</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Login successful"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Failed to log in"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This is because C# (obviously) already has support for classes and interfaces. But what about some of the language constructs in F# that simply do not exist in C#?</p>

<p>The rest of this article will cover what some of these constructs look like when they are exposed to C# projects without being wrapped up in an OO friendly class like the one above. This article is not a guide to the recommended best practices, but instead aims to offer some insight into what F# compiles down to and justifies why the guidelines are needed. This article covers F# 4.1 and C# 7.</p>

<h1 id="namespaces">Namespaces</h1>
<p>F# projects do not have a <em>default namespace</em> option in their project settings. If you do not put a module in a namespace, then it becomes available globally in any C# projects that reference its project.</p>

<p>The following F# function:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">add</span> <span class="n">num1</span> <span class="n">num2</span> <span class="p">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span>
</code></pre></div></div>

<p>Can be consumed in C# like so:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Interoperability.CSharp</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">Example</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">));</span> <span class="c1">//prints 3</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note that the C# code does not require a <code class="highlighter-rouge">using</code> statement to use the F# <code class="highlighter-rouge">Example</code> module. If we add a namespace to the module:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">Interoperability</span><span class="p">.</span><span class="nc">FSharp</span>

<span class="k">module</span> <span class="nc">Example</span> <span class="p">=</span>
    <span class="k">let</span> <span class="n">add</span> <span class="n">num1</span> <span class="n">num2</span> <span class="p">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span>
</code></pre></div></div>

<p>Then a <code class="highlighter-rouge">using</code> statement is required in the C# project:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Interoperability.FSharp</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Interoperability.CSharp</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">Example</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">));</span> <span class="c1">//prints 3</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="modules">Modules</h1>
<p>As shown in the namespace section of this article, modules are exposed to C# as static classes. If you want to replicate being able to <code class="highlighter-rouge">open</code> a module from C#, you can use a <code class="highlighter-rouge">using static</code> statement like so:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">static</span> <span class="n">Interoperability</span><span class="p">.</span><span class="n">FSharp</span><span class="p">.</span><span class="n">Example</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Interoperability.CSharp</span>
<span class="p">{</span>
    <span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="k">add</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">));</span> <span class="c1">//prints 3</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="values">Values</h2>
<p>Modules can contain values:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">message</span> <span class="p">=</span> <span class="s2">"This is an example getter"</span>
</code></pre></div></div>

<p>These values are exposed to C# as properties with a getter:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">message</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Modules can also contain mutable values:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="k">mutable</span> <span class="n">message</span> <span class="p">=</span> <span class="s2">"This is an example getter"</span>
</code></pre></div></div>

<p>Mutable values are exposed to C# as properties with a getter and setter:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">message</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="functions">Functions</h1>
<p>As shown in the <a href="#modules">modules</a> section, F# functions are exposed as you’d expect. In F#, functions are curried and can be partially applied. When accessing an F# function from C#, this functionality is not available. You must provide all parameters to a function when calling it.</p>

<h1 id="records">Records</h1>
<p>F# records are exposed to C# as classes that take in all of their properties in their constructor. The following F# record contains a <code class="highlighter-rouge">string</code>, an <code class="highlighter-rouge">int</code> and an <code class="highlighter-rouge">IEnumerable&lt;string&gt;</code>:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="nc">Person</span> <span class="p">=</span> <span class="p">{</span>
    <span class="n">id</span><span class="p">:</span> <span class="kt">int</span>
    <span class="n">name</span><span class="p">:</span> <span class="kt">string</span>
    <span class="n">friends</span><span class="p">:</span> <span class="kt">string</span> <span class="n">seq</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This record is exposed to C# as a class with the following signature<sup id="fnref:person-typo"><a href="#fn:person-typo" class="footnote">1</a></sup>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Person</span> <span class="p">:</span> <span class="n">IEquatable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;,</span> <span class="n">IStructuralEquatable</span><span class="p">,</span> <span class="n">IComparable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;,</span> <span class="n">IComparable</span><span class="p">,</span> <span class="n">IStructuralComparable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">Person</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">friends</span><span class="p">);</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">friends</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="n">Person</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">,</span> <span class="n">IComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">,</span> <span class="n">IEqualityComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">Person</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">(</span><span class="n">IEqualityComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Records have the following characteristics when used from C#:</p>
<ul>
  <li>All properties are readonly (getters only)</li>
  <li>Properties are populated via the constructor</li>
  <li>Various comparison interfaces are implemented for you</li>
</ul>

<p>This means records work exactly as you would expect in C#:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Person</span> <span class="n">person1</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Person</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="s">"connel"</span><span class="p">,</span> <span class="k">new</span> <span class="p">[]{</span><span class="s">"bob"</span><span class="p">});</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">person1</span><span class="p">.</span><span class="n">id</span><span class="p">);</span> <span class="c1">//prints 42</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">person1</span><span class="p">.</span><span class="n">name</span><span class="p">);</span> <span class="c1">//prints connel</span>

    <span class="n">Person</span> <span class="n">person2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Person</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="s">"connel"</span><span class="p">,</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"bob"</span> <span class="p">});</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">person1</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">person2</span><span class="p">)</span> <span class="p">?</span> <span class="s">"same"</span> <span class="p">:</span> <span class="s">"not same"</span><span class="p">);</span> <span class="c1">//prints same</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="tuples">Tuples</h1>
<h2 id="background">Background</h2>
<p>A very brief history of tuples types in .NET:</p>

<ul>
  <li>F# has had support for tuples since its inception. It uses the <a target="_BLANK" href="https://msdn.microsoft.com/en-us/library/system.tuple(v=vs.110).aspx">System.Tuple</a> class.</li>
  <li>Recently, C#7 added support for tuples. To do this it created a new struct type called <a target="_BLANK" href="https://msdn.microsoft.com/en-us/library/system.valuetuple(v=vs.110).aspx">System.ValueTuple</a>.</li>
  <li>F# 4.1 recently added support for the ValueTuple.</li>
</ul>

<p>According to the <a target="_BLANK" href="https://msdn.microsoft.com/en-us/library/system.valuetuple(v=vs.110).aspx#Anchor_3">MSDN docs</a> for the ValueTuple, there are three main differences between the Tuple and ValueTuple:</p>

<table>
  <thead>
    <tr>
      <th>Tuple</th>
      <th>ValueTuple</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Class</td>
      <td>Struct</td>
    </tr>
    <tr>
      <td>Immutable</td>
      <td>Mutable</td>
    </tr>
    <tr>
      <td>Items are properties</td>
      <td>Items are fields</td>
    </tr>
  </tbody>
</table>

<p><a target="_BLANK" href="http://mustoverride.com/tuples_structs/">This article</a> explains the design decisions C# took when creating the ValueTuple.</p>

<h2 id="f-tuple">F# Tuple</h2>
<p>Let’s see how F# tuples (System.Tuple) can be used in C#.</p>

<p>The following F# function takes in a tuple and returns a tuple:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">flipFSharpTuple</span> <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span> <span class="p">=</span> 
        <span class="p">(</span><span class="n">val2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span>
</code></pre></div></div>

<p>It can be consumed in C# like so:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">(</span><span class="kt">string</span> <span class="n">result1</span><span class="p">,</span> <span class="kt">string</span> <span class="n">result2</span><span class="p">)</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="nf">flipFSharpTuple</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">result1</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">result2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span> <span class="c1">//prints b a</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="comparison">
    <div class="section">
        <div class="title">Tuple in parameter</div>
        <p class="content"><code>flipFSharpTuple("a", "b")</code></p>
        <p class="content">The F# function's single tuple parameter gets exposed as multiple parameters to C#.</p>
    </div>
    <div class="section">
        <div class="title">Returned tuple</div>
        <p class="content"><code>(string result1, string result2)</code></p>
        <p class="content">The System.Tuple class has a deconstructor that allows us to unpack the values inside it, just like we would in F#.</p>
        <p class="content">
            A deconstructor does not actually return a tuple, but instead it uses a new feature in C# 7 that makes <code>out</code> parameters appear like tuples. You can read more about deconstructors <a href="https://msdn.microsoft.com/en-us/magazine/mt790184.aspx" target="_BLANK">here</a>.
        </p>
    </div>
</div>

<p>The following F# function takes in and returns a tuple that contains a tuple:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">flipFSharpInnerTuple</span> <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="p">(</span><span class="n">val2</span><span class="p">,</span> <span class="n">val3</span><span class="o">))</span> <span class="p">=</span> 
        <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="p">(</span><span class="n">val3</span><span class="p">,</span> <span class="n">val2</span><span class="o">))</span>
</code></pre></div></div>

<p>It can be consumed in C# like so:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">(</span><span class="kt">string</span> <span class="n">result1</span><span class="p">,</span> <span class="p">(</span><span class="kt">string</span> <span class="n">result2</span><span class="p">,</span> <span class="kt">string</span> <span class="n">result3</span><span class="p">))</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="nf">flipFSharpInnerTuple</span><span class="p">(</span><span class="s">"a"</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">));</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">result1</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">result2</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">result3</span><span class="p">}</span><span class="s">"</span><span class="p">);</span> <span class="c1">//prints a c b</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="comparison">
    <div class="section">
        <div class="title">Tuple in parameter</div>
        <p class="content"><code>flipFSharpInnerTuple("a", Tuple.Create("b", "c"))</code></p>
        <p class="content">The inner tuple requires a tuple to be instantiated, so consuming this function in C# is not as succinct as it would be from F#.</p>
    </div>
    <div class="section">
        <div class="title">Returned tuple</div>
        <p class="content"><code>(string result1, (string result2, string result3))</code></p>
        <p class="content">The returned nested tuple can still be deconstructed just fine.</p>
    </div>
</div>

<p>Below is the code that the nested example above gets compiled down to:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Interoperability.CSharp</span>
<span class="p">{</span>
  <span class="k">internal</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Program</span>
  <span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
      <span class="kt">string</span> <span class="n">str1</span><span class="p">;</span>
      <span class="n">Tuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">tuple</span><span class="p">;</span>
      <span class="n">Example</span>
        <span class="p">.</span><span class="n">flipFSharpInnerTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="s">"a"</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">.</span><span class="n">Create</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">))</span>
        <span class="p">.</span><span class="n">Deconstruct</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;(</span><span class="k">out</span> <span class="n">str1</span><span class="p">,</span> <span class="k">out</span> <span class="n">tuple</span><span class="p">);</span>
      <span class="kt">string</span> <span class="n">str2</span><span class="p">;</span>
      <span class="kt">string</span> <span class="n">str3</span><span class="p">;</span>
      <span class="n">tuple</span><span class="p">.</span><span class="n">Deconstruct</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="k">out</span> <span class="n">str2</span><span class="p">,</span> <span class="k">out</span> <span class="n">str3</span><span class="p">);</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"{0} {1} {2}"</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">str1</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">str2</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">str3</span><span class="p">));</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>The first element of the tuple is deconstructed into out a variable called <code class="highlighter-rouge">str1</code>.</li>
  <li>The second element of the tuple (which is also a tuple) is deconstructed into out a variable called <code class="highlighter-rouge">tuple</code>.</li>
  <li>Then each element of nested tuple is deconstructed into variables called <code class="highlighter-rouge">str2</code> and <code class="highlighter-rouge">str3</code></li>
</ul>

<h2 id="c-tuple">C# Tuple</h2>
<p>Let’s see how C# tuples (System.ValueTuple) created in F# can be used in C#. To create a C# tuple in F# the <code class="highlighter-rouge">struct</code> keyword is used.</p>

<p>The following F# function takes in a tuple and returns a tuple:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">flipCSharpTuple</span> <span class="k">struct</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span> <span class="p">=</span> 
        <span class="k">struct</span><span class="p">(</span><span class="n">val2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span>
</code></pre></div></div>

<p>It can be consumed in C# like so:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nc">Main</span><span class="bp">()</span>
<span class="p">{</span>
    <span class="p">(</span><span class="kt">string</span> <span class="n">result1</span><span class="p">,</span> <span class="kt">string</span> <span class="n">result2</span><span class="p">)</span> <span class="p">=</span> <span class="nn">Example</span><span class="p">.</span><span class="n">flipCSharpTuple</span><span class="o">((</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="o">));</span>
    <span class="nn">Console</span><span class="p">.</span><span class="nc">WriteLine</span><span class="o">($</span><span class="s2">"{result1} {result2}"</span><span class="o">);</span> <span class="c1">//prints b a</span>
    <span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="comparison">
    <div class="section">
        <div class="title">Tuple in parameter</div>
        <p class="content"><code>flipCSharpTuple(("a", "b"))</code></p>
        <p class="content">The F# function's single tuple parameter gets exposed as a single tuple parameter to C#. This results in the slightly weird double bracket syntax.</p>
        <p class="content">This may seem weird at first but this syntax is a nice way of immediately knowing whether a function is taking in a single tuple or a series of parameters.</p>
    </div>
    <div class="section">
        <div class="title">Returned tuple</div>
        <p class="content"><code>(string result1, string result2)</code></p>
        <p class="content">Unlike with F# tuples, where a deconstructor is used, this object is a genuine tuple.</p>
    </div>
</div>

<p>The following F# function takes in and returns a tuple that contains a tuple:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">flipCSharpInnerTuple</span> <span class="k">struct</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="k">struct</span><span class="p">(</span><span class="n">val2</span><span class="p">,</span> <span class="n">val3</span><span class="o">))</span> <span class="p">=</span> 
        <span class="k">struct</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="k">struct</span><span class="p">(</span><span class="n">val3</span><span class="p">,</span> <span class="n">val2</span><span class="o">))</span>
</code></pre></div></div>

<p>It can be consumed in C# like so:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">(</span><span class="kt">string</span> <span class="n">result1</span><span class="p">,</span> <span class="p">(</span><span class="kt">string</span> <span class="n">result2</span><span class="p">,</span> <span class="kt">string</span> <span class="n">result3</span><span class="p">))</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="nf">flipCSharpInnerTuple</span><span class="p">((</span><span class="s">"a"</span><span class="p">,</span> <span class="p">(</span><span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">)));</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">result1</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">result2</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">result3</span><span class="p">}</span><span class="s">"</span><span class="p">);</span> <span class="c1">//prints a c b</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="comparison">
    <div class="section">
        <div class="title">Tuple in parameter</div>
        <p class="content"><code>flipCSharpInnerTuple(("a", ("b", "c")))</code></p>
        <p class="content">Unlike with F# tuples, the inner tuple in the function's parameter can be instantiated just as you would in F#.</p>
    </div>
    <div class="section">
        <div class="title">Returned tuple</div>
        <p class="content"><code>(string result1, (string result2, string result3))</code></p>
        <p class="content">As you would expect, the returned nested tuple can also be unpacked just fine.</p>
    </div>
</div>

<p>Below is the code that the nested example above gets compiled down to:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">ValueTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">ValueTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">valueTuple1</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="n">flipCSharpInnerTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">ValueTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">ValueTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;(</span><span class="s">"a"</span><span class="p">,</span> <span class="k">new</span> <span class="n">ValueTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span><span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">)));</span>
    <span class="n">ValueTuple</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">valueTuple2</span> <span class="p">=</span> <span class="n">valueTuple1</span><span class="p">.</span><span class="n">Item2</span><span class="p">;</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"{0} {1} {2}"</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">valueTuple1</span><span class="p">.</span><span class="n">Item1</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">valueTuple2</span><span class="p">.</span><span class="n">Item1</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">valueTuple2</span><span class="p">.</span><span class="n">Item2</span><span class="p">));</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>The outer tuple is placed in a variable called <code class="highlighter-rouge">valueTuple1</code></li>
  <li>The inner tuple is pulled out into its own variable called <code class="highlighter-rouge">valueTuple2</code></li>
  <li>The elements from inside the tuples are simply accessed from their tuple e.g. <code class="highlighter-rouge">valueTuple1.Item1</code></li>
  <li>No deconstructors are used like the F# tuples</li>
</ul>

<p>I’m sure it will come as no surprise to you that C# tuples work better in C# than F# tuples.</p>

<h1 id="discriminated-unions">Discriminated Unions</h1>
<p>There are two types of discriminated unions in F#. Those that contain compile-time constant values and those that contain types.</p>

<h2 id="cases-with-values">Cases With Values</h2>
<p>Discriminated unions that contain values are compiled down to enums and are therefore easy to consume in C#.</p>

<p>The following F# type:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="nc">LogLevels</span> <span class="p">=</span>
<span class="p">|</span> <span class="nc">Error</span> <span class="p">=</span> <span class="mi">1</span>
<span class="p">|</span> <span class="nc">Warning</span> <span class="p">=</span> <span class="mi">2</span>
<span class="p">|</span> <span class="nc">Info</span> <span class="p">=</span> <span class="mi">3</span>
</code></pre></div></div>

<p>Is compiled down to the following enum:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">enum</span> <span class="n">LogLevels</span>
<span class="p">{</span>
    <span class="n">Error</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="n">Warning</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
    <span class="n">Info</span> <span class="p">=</span> <span class="m">3</span>
<span class="p">}</span>
</code></pre></div></div>

<p>F# has support for using <code class="highlighter-rouge">char</code>s as values but these types cannot be used in C#. The following F# type:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="nc">LogLevels</span> <span class="p">=</span>
<span class="p">|</span> <span class="nc">Error</span> <span class="p">=</span> <span class="k">'</span><span class="n">a'</span>
<span class="p">|</span> <span class="nc">Warning</span> <span class="p">=</span> <span class="k">'</span><span class="n">b'</span>
<span class="p">|</span> <span class="nc">Info</span> <span class="p">=</span> <span class="k">'</span><span class="n">c'</span>
</code></pre></div></div>

<p>Gives the following error in C#:</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/enum-char.png" alt="Screenshot of Visual Studio displaying an error when trying to use a char enum from F#" /></p>

<h2 id="cases-with-types">Cases With Types</h2>
<p>The most common form of discriminated unions however, have cases that are either empty or contain types.</p>

<p>The following F# discriminated union type:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="nc">LogLevels</span> <span class="p">=</span>
<span class="p">|</span> <span class="nc">Error</span>
<span class="p">|</span> <span class="nc">Warning</span>
<span class="p">|</span> <span class="nc">Info</span>
</code></pre></div></div>

<p>Is exposed to C# as a class with the following signature:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">LogLevels</span> <span class="p">:</span> <span class="n">IEquatable</span><span class="p">&lt;</span><span class="n">LogLevels</span><span class="p">&gt;,</span> <span class="n">IStructuralEquatable</span><span class="p">,</span> <span class="n">IComparable</span><span class="p">&lt;</span><span class="n">LogLevels</span><span class="p">&gt;,</span> <span class="n">IComparable</span><span class="p">,</span> <span class="n">IStructuralComparable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">LogLevels</span> <span class="n">Error</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">LogLevels</span> <span class="n">Warning</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">LogLevels</span> <span class="n">Info</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsInfo</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Tag</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsError</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsWarning</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="n">LogLevels</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">,</span> <span class="n">IComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">,</span> <span class="n">IEqualityComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">LogLevels</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">(</span><span class="n">IEqualityComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Tags</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Error</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Warning</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Info</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see from the signature above, the class exposes three <code class="highlighter-rouge">LogLevels</code> properties (Error, Warning and Info). These properties return instances of the <code class="highlighter-rouge">LogLevel</code>. This class is <code class="highlighter-rouge">sealed</code> so nothing can inherit off it, this means we know that the objects returned by these properties are of the type <code class="highlighter-rouge">LogLevels</code> and not a sub-class.</p>

<p>C# 7 has introduced very basic <a target="_BLANK" href="https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/">pattern matching</a> that allows us to use the <code class="highlighter-rouge">switch</code> statement to switch on an object’s type. Unfortunately, we cannot use C#’s new pattern matching with this type, as each case is not given its own type to match onto.</p>

<p>This means we switch using the tag instead. This is less elegant:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LogLevels</span> <span class="n">level</span> <span class="p">=</span> <span class="n">LogLevels</span><span class="p">.</span><span class="n">Info</span><span class="p">;</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">level</span><span class="p">.</span><span class="n">Tag</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="n">LogLevels</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"error"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">LogLevels</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">Warning</span><span class="p">:</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"warning"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">LogLevels</span><span class="p">.</span><span class="n">Tags</span><span class="p">.</span><span class="n">Info</span><span class="p">:</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"info"</span><span class="p">);</span> <span class="c1">//prints info</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now let’s look at the following F# type:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="nc">LogLevels</span> <span class="p">=</span>
<span class="p">|</span> <span class="nc">Error</span> <span class="k">of</span> <span class="kt">int</span>
<span class="p">|</span> <span class="nc">Warning</span> <span class="k">of</span> <span class="k">struct</span><span class="p">(</span><span class="kt">int</span> <span class="p">*</span> <span class="kt">string</span><span class="p">)</span>
<span class="p">|</span> <span class="nc">Info</span> <span class="k">of</span> <span class="kt">string</span>
</code></pre></div></div>

<p>This type is exposed to C# as a class with the following signature:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">LogLevels</span> <span class="p">:</span> <span class="n">IEquatable</span><span class="p">&lt;</span><span class="n">LogLevels</span><span class="p">&gt;,</span> <span class="n">IStructuralEquatable</span><span class="p">,</span> <span class="n">IComparable</span><span class="p">&lt;</span><span class="n">LogLevels</span><span class="p">&gt;,</span> <span class="n">IComparable</span><span class="p">,</span> <span class="n">IStructuralComparable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsInfo</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsWarning</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsError</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Tag</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">LogLevels</span> <span class="nf">NewError</span><span class="p">(</span><span class="kt">int</span> <span class="n">item</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">LogLevels</span> <span class="nf">NewInfo</span><span class="p">(</span><span class="kt">string</span> <span class="n">item</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">LogLevels</span> <span class="nf">NewWarning</span><span class="p">((</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="n">item</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="n">LogLevels</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">CompareTo</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">,</span> <span class="n">IComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="kt">object</span> <span class="n">obj</span><span class="p">,</span> <span class="n">IEqualityComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Equals</span><span class="p">(</span><span class="n">LogLevels</span> <span class="n">obj</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">sealed</span> <span class="k">override</span> <span class="kt">int</span> <span class="nf">GetHashCode</span><span class="p">(</span><span class="n">IEqualityComparer</span> <span class="n">comp</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Tags</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Error</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Warning</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">Info</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Warning</span> <span class="p">:</span> <span class="n">LogLevels</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">)</span> <span class="n">Item</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Error</span> <span class="p">:</span> <span class="n">LogLevels</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Item</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Info</span> <span class="p">:</span> <span class="n">LogLevels</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Item</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This time the compiler has created sub-classes for us, so C# pattern matching <em>does</em> work on this type:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LogLevels</span> <span class="n">errorLevel</span> <span class="p">=</span> <span class="n">LogLevels</span><span class="p">.</span><span class="nf">NewError</span><span class="p">(</span><span class="m">42</span><span class="p">);</span>
    <span class="n">LogLevels</span> <span class="n">warningLevel</span> <span class="p">=</span> <span class="n">LogLevels</span><span class="p">.</span><span class="nf">NewWarning</span><span class="p">((</span><span class="m">42</span><span class="p">,</span> <span class="s">"message"</span><span class="p">));</span>
    <span class="n">LogLevels</span> <span class="n">infoLevel</span> <span class="p">=</span> <span class="n">LogLevels</span><span class="p">.</span><span class="nf">NewInfo</span><span class="p">(</span><span class="s">"message"</span><span class="p">);</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">infoLevel</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">case</span> <span class="n">LogLevels</span><span class="p">.</span><span class="n">Error</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"error </span><span class="p">{</span><span class="n">e</span><span class="p">.</span><span class="n">Item</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">LogLevels</span><span class="p">.</span><span class="n">Warning</span> <span class="n">w</span><span class="p">:</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"warning </span><span class="p">{</span><span class="n">w</span><span class="p">.</span><span class="n">Item</span><span class="p">.</span><span class="n">Item1</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">w</span><span class="p">.</span><span class="n">Item</span><span class="p">.</span><span class="n">Item2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">LogLevels</span><span class="p">.</span><span class="n">Info</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"info </span><span class="p">{</span><span class="n">i</span><span class="p">.</span><span class="n">Item</span><span class="p">}</span><span class="s">"</span><span class="p">);</span> <span class="c1">//prints info message</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Somewhat annoyingly, the union case’s contents are put inside an <code class="highlighter-rouge">Item</code> property. This isn’t as succinct as an F# match expression, where the value is unpacked into a local variable for you. I guess this is more an issue with the C# switch statement than it is with the discriminated union itself.</p>

<p>It would be much more reasonable if discriminated unions with empty cases were either compiled down to enums or were given empty sub-classes. Empty sub-classes would be better as it would cover discriminated unions that have both empty and none-empty cases.</p>

<h1 id="unit">Unit</h1>
<p>Functions that return unit, return void in C#. The following pointless F# code takes in unit and returns unit:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">run</span> <span class="bp">()</span> <span class="p">=</span> <span class="bp">()</span>
</code></pre></div></div>
<p>This function is exposed to C# as a method that has no parameters and returns void:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">run</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>
<p>So far so good. But what happens if we write a really (really) pointless function that takes in a tuple (that contains a value and unit) and then returns the same tuple flipped:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">flipUnitTuple</span> <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="bp">()</span><span class="p">)</span> <span class="p">=</span> 
        <span class="k">struct</span><span class="o">((),</span> <span class="n">val1</span><span class="p">)</span>
</code></pre></div></div>

<p>To consume this function, we are asked to reference FSharp.Core:</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/unit-add-f-sharp-core-reference.png" alt="Screenshot of Visual Studio asking to add a reference to F# Core to use the unit type" /></p>

<p>Before finding out that we cannot instantiate unit anyway:</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/unit-failing-to-construct.png" alt="Screenshot of Visual Studio error message when trying to construct a unit type" /></p>

<p>Instead of constructing the unit type however, we can simply pass in null like so<sup id="fnref:unit-null"><a href="#fn:unit-null" class="footnote">2</a></sup>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">(</span><span class="n">Unit</span> <span class="n">empty</span><span class="p">,</span> <span class="kt">int</span> <span class="n">result</span><span class="p">)</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="nf">flipUnitTuple</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result</span><span class="p">);</span> <span class="c1">//prints 42</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="higher-order-functions">Higher Order Functions</h1>
<p>The following F# module contains a function that takes in another function as its second parameter:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module Example
    let pipe i mapper =
        mapper(i)
</code></pre></div></div>

<p>It is exposed to C# as a class with the following signature:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">b</span> <span class="n">pipe</span><span class="p">&lt;</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">&gt;(</span><span class="n">a</span> <span class="n">i</span><span class="p">,</span> <span class="n">FSharpFunc</span><span class="p">&lt;</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">&gt;</span> <span class="n">mapper</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Unfortunately, this function does not expose itself to C# in the way you’d expect. Instead of finding the C# friendly <code class="highlighter-rouge">Func</code> type as the second parameter, we find a new type called <code class="highlighter-rouge">FSharpFunc</code>. Consuming this function in C# is not pretty:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="m">42</span><span class="p">,</span> <span class="n">FSharpFunc</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;.</span><span class="nf">FromConverter</span><span class="p">(</span><span class="n">input</span> <span class="p">=&gt;</span> <span class="n">input</span> <span class="p">*</span> <span class="m">2</span><span class="p">));</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result</span><span class="p">);</span> <span class="c1">//prints 84</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We have to use a converter to convert a C# <code class="highlighter-rouge">Func</code> type into the equivalent <code class="highlighter-rouge">FSharpFunc</code> type. I’m sure there are good architectural reasons why they both have different func types, but it sure would be nice if the compiler did the heavy lifting here for us, like it does with the unit type and void.</p>

<h1 id="option">Option</h1>
<p>The following F# module contains a function that returns an option type:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">open</span> <span class="nc">System</span>
    <span class="k">let</span> <span class="n">parseInt</span> <span class="n">x</span> <span class="p">=</span>
        <span class="k">match</span> <span class="nn">Int32</span><span class="p">.</span><span class="nc">TryParse</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">with</span>
        <span class="p">|</span> <span class="n">success</span><span class="p">,</span> <span class="n">result</span> <span class="k">when</span> <span class="n">success</span> <span class="p">-&gt;</span> <span class="nc">Some</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">|</span> <span class="p">_</span> <span class="p">-&gt;</span> <span class="nc">None</span>
</code></pre></div></div>

<p>It is exposed to C# as a class with the following signature:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Microsoft</span><span class="p">.</span><span class="n">FSharp</span><span class="p">.</span><span class="n">Core</span><span class="p">.</span><span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="nf">parseInt</span><span class="p">(</span><span class="kt">string</span> <span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To consume this function in C# we must reference FSharp.Core - just like we did for the unit type:</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/option-add-f-sharp-core-reference.png" alt="Screenshot of Visual Studio asking to add a reference to F# Core to use the option type" /></p>

<p>We can assign values to option types without a hitch in C#:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">result1</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="nf">parseInt</span><span class="p">(</span><span class="s">"42"</span><span class="p">);</span>
    <span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">result2</span> <span class="p">=</span> <span class="m">42</span><span class="p">;</span> <span class="c1">//implicit operator</span>
    <span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">result3</span> <span class="p">=</span> <span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;.</span><span class="nf">Some</span><span class="p">(</span><span class="m">42</span><span class="p">);</span>
    <span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">result4</span> <span class="p">=</span> <span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;.</span><span class="n">None</span><span class="p">;</span>
    
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result1</span><span class="p">);</span> <span class="c1">//prints Some(42)</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result2</span><span class="p">);</span> <span class="c1">//prints Some(42)</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result3</span><span class="p">);</span> <span class="c1">//prints Some(42)</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result4</span><span class="p">);</span> <span class="c1">//prints nothing</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Unfortunately, options become pretty useless once we want to access the values we’ve assigned to them. The option type does not expose much to C# 7 projects.</p>

<p>Below is a screenshot of Intellisense when using an instance of the option class:</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/option-instance.png" alt="Screenshot of Visual Studio Intellisense when using an option instance" /></p>

<p>Below is a screenshot of Intellisense when using static methods in the option class:</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/option-static.png" alt="Screenshot of Visual Studio Intellisense when using an option instance" /></p>

<p>One surprising thing I found was that the <code class="highlighter-rouge">None</code> property returned null.</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/option-null-reference-exception.png" alt="Screenshot of Visual Studio null reference exception when using none type" /></p>

<p>Due to the lack of functionality exposed by the option type to C#, it becomes awkward to use:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nf">Print</span><span class="p">(</span><span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;.</span><span class="n">None</span><span class="p">);</span> <span class="c1">//prints value is: none</span>
    <span class="nf">Print</span><span class="p">(</span><span class="n">Example</span><span class="p">.</span><span class="nf">parseInt</span><span class="p">(</span><span class="s">"42"</span><span class="p">));</span> <span class="c1">//prints value is: 42</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Print</span><span class="p">(</span><span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">FSharpOption</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;.</span><span class="nf">get_IsNone</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"value is: none"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"value is: </span><span class="p">{</span><span class="n">item</span><span class="p">.</span><span class="n">Value</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see you lose <em>all</em> the benefits of the option type in C#. If you want use something like the option type in C#, you’ll have to stick with one of the already well established NuGet packages like <a target="_BLANK" href="https://www.nuget.org/packages/Strilanc.Value.May/">Strilanc.Value.May</a>.</p>

<h1 id="collections">Collections</h1>
<p>There are three main types of collections in F#.</p>

<h2 id="seq">Seq</h2>
<p>The following F# module contains a function that returns <code class="highlighter-rouge">seq</code>:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">getSeq</span> <span class="p">=</span> <span class="n">seq</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="s2">"a"</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>It is exposed to C# as a class with the following signature:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">getSeq</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Seq</code> is an alias for <code class="highlighter-rouge">IEnumerable</code> so is perfectly consumable from C#.</p>

<h2 id="list">List</h2>
<p>The following F# module contains a function that returns an F# <code class="highlighter-rouge">list</code>:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">getList</span> <span class="p">=</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">]</span>
</code></pre></div></div>

<p>It is exposed to C# as a class with the following signature:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">FSharpList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">getList</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, F# lists are not the same as C# lists. F# lists are immutable linked lists, so they differ in their implementation to C# lists.</p>

<p>To consume this function in C# we must reference FSharp.Core - just like we did for the unit and option types:</p>

<p><img src="https://connelhooley.uk/assets/images/f-sharp-to-c-sharp/list-add-f-sharp-core-reference.png" alt="Screenshot of Visual Studio asking to add a reference to F# Core to use the F# list type" /></p>

<p>We can then consume the list like so:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">FSharpList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">result</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="n">getList</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">s</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="c1">//prints a</span>
    <span class="p">}</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span> <span class="c1">//prints a</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>F# lists are easy to consume from C#, although it is always better practice to expose <code class="highlighter-rouge">IEnumerable</code>s to your C# projects. It is also worth mentioning that, as of F# 4.1, the <code class="highlighter-rouge">FSharpList</code> type also implements the <code class="highlighter-rouge">IReadOnlyCollection</code> interface, so that can be used instead. The following example demonstrates this:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">IReadOnlyCollection</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">result</span> <span class="p">=</span> <span class="n">Example</span><span class="p">.</span><span class="n">getList</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">s</span> <span class="k">in</span> <span class="n">result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="c1">//prints a</span>
    <span class="p">}</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="nf">ElementAt</span><span class="p">(</span><span class="m">0</span><span class="p">));</span> <span class="c1">//prints a</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The code above still requires a references to FSharp.Core. It would be much nicer to consume F# lists in C# if they were exposed using this more C# friendly interface. Just like how the <code class="highlighter-rouge">seq</code> type is exposed as the C# friendly <code class="highlighter-rouge">IEnumerable</code> interface.</p>

<p>If you want to return a C# <code class="highlighter-rouge">List</code> from an F# function, then you must return the <code class="highlighter-rouge">ResizeArray</code><sup id="fnref:list"><a href="#fn:list" class="footnote">3</a></sup> type which acts as an alias to the C# list type.</p>

<h2 id="array">Array</h2>
<p>The following F# module contains a function that returns an F# <code class="highlighter-rouge">array</code>:</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nc">Example</span>
    <span class="k">let</span> <span class="n">getList</span> <span class="p">=</span> <span class="p">[|</span><span class="s2">"a"</span><span class="p">|]</span>
</code></pre></div></div>

<p>It is exposed to C# as a class with the following signature:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Example</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">getList</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Arrays are the same in F# as in C# so they perfectly consumable from C#.</p>

<div class="references-title">References</div>
<div class="footnotes">
  <ol>
    <li id="fn:person-typo">
      <p>Thanks to Haumohio Ltd in the comments for spotting a typo here <small>(I have since moved my comments from Disqus to Facebook)</small>. <a href="#fnref:person-typo" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:unit-null">
      <p>Thanks to vaskir (@kot_2010) on Twitter for pointing out that null can be used when a function takes in unit. <a href="#fnref:unit-null" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:list">
      <p>Thanks to Stuart in the comments for pointing out the <a target="_BLANK" href="https://msdn.microsoft.com/en-us/visualfsharpdocs/conceptual/collections.resizearray%5B't%5D-type-abbreviation-%5Bfsharp%5D">ResizeArray</a> type <small>(I have since moved my comments from Disqus to Facebook)</small>. <a href="#fnref:list" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

            </div>
            
            <div id="comments">
                
<div class="fb-comments" data-href="https://connelhooley.uk/blog/2017/04/30/f-sharp-to-c-sharp" data-numposts="5" data-width="100%"></div>

            </div>
            
        </div>
    </div>
</article>
</main>    
    <footer id="site-footer" class="site-footer-post">
        <div id="site-footer-inner">
            <div id="site-footer-copy">
                Connel Hooley <i class="far fa-copyright"></i> 2018
            </div>
            
            <div id="site-footer-contact">
                <a href="mailto:me@connelhooley.uk" target="_BLANK"><i class="fas fa-envelope fa-fw"></i>&nbsp;Email</a>&nbsp;&bull;
                <a href="https://twitter.com/connel_dev" target="_BLANK"><i class="fab fa-twitter fa-fw"></i>&nbsp;Twitter</a>&nbsp;&bull;
                <a href="http://uk.linkedin.com/in/connelhooley" target="_BLANK"><i class="fab fa-linkedin fa-fw"></i>&nbsp;LinkedIn</a>&nbsp;&bull;
                <a href="/feed.xml" target="_BLANK"><i class="fas fa-rss"></i>&nbsp;Blog RSS</a>
            </div>
            
        </div>
    </footer>
    
    <script src="/assets/js/vendor/jquery-3.1.1.min.js?1589473142522212500"></script>
    <script src="/assets/js/vendor/moment.min.js?1589473142522212500"></script>
    <script src="/assets/js/vendor/clipboard.min.js?1589473142522212500"></script>
    <script src="/assets/js/vendor/js.cookie.js?1589473142522212500"></script>
    <script src="/assets/js/vendor/stickyfill.min.js?1589473142522212500"></script>
    
    <script src="/assets/js/vendor/fixanchorlinks.js?1589473142522212500"></script>
    
    <script src="/assets/js/main.js?1589473142522212500"></script>
    
</body>